<!DOCTYPE html>
<html>
<head>
  <title>DigiDollar Dashboard</title>
  <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f4f4f4;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 360px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
    }
    button {
      background: #28a745;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>DigiDollar Dashboard</h2>
  <button onclick="connectWallet()">Connect Wallet</button>
  <p><strong>Your Wallet:</strong> <span id="walletAddress">Not connected</span></p>
  <p><strong>Your DUSD Balance:</strong> <span id="balance">--</span></p>
  <p><strong>USD Value:</strong> <span id="usdValue">--</span></p>

  <h4>Mint Tokens (Owner Only)</h4>
  <input id="mintTo" placeholder="Recipient Address">
  <input id="mintAmount" placeholder="Amount (whole DUSD)">
  <button onclick="mintTokens()">Mint</button>

  <h4>Send DUSD</h4>
  <input id="sendTo" placeholder="Recipient Address">
  <input id="sendAmount" placeholder="Amount (whole DUSD)">
  <button onclick="sendTokens()">Send</button>

  <h4>Swap DUSD for ETH</h4>
  <input id="swapAmount" placeholder="Amount of DUSD">
  <button onclick="swap()">Swap for ETH</button>
</div>

<script>
let provider, signer, contract;
const contractAddress = "0xECf7B7BA8768f07993c8CEf0b3dB6d7D5ad380ae";
const contractABI = [
  "function balanceOf(address) public view returns (uint256)",
  "function transfer(address to, uint amount) public returns (bool)",
  "function mint(address to, uint256 amount) public",
  "function swapDUSDForETH(uint256 amount) public",
  "function getUSDValue(uint256 tokenAmount) public view returns (uint256)"
];

async function connectWallet() {
  if (!window.ethereum) return alert("MetaMask is required");
  try {
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    const address = await signer.getAddress();
    document.getElementById("walletAddress").innerText = address;
    contract = new ethers.Contract(contractAddress, contractABI, signer);
    loadBalance();
  } catch (err) {
    alert("Failed to connect wallet.");
    console.error(err);
  }
}

async function loadBalance() {
  try {
    const address = await signer.getAddress();
    const balance = await contract.balanceOf(address);
    document.getElementById("balance").innerText = `${ethers.utils.formatUnits(balance, 18)} DUSD`;
    const usd = await contract.getUSDValue(balance);
    document.getElementById("usdValue").innerText = `$${ethers.utils.formatUnits(usd, 18)}`;
  } catch (err) {
    console.error("Error loading balance", err);
  }
}

async function mintTokens() {
  try {
    const to = document.getElementById("mintTo").value;
    const amount = ethers.utils.parseUnits(document.getElementById("mintAmount").value, 18);
    const tx = await contract.mint(to, amount);
    await tx.wait();
    alert("Mint complete!");
    loadBalance();
  } catch (err) {
    alert("Mint failed.");
    console.error(err);
  }
}

async function sendTokens() {
  try {
    const to = document.getElementById("sendTo").value;
    const amount = ethers.utils.parseUnits(document.getElementById("sendAmount").value, 18);
    const tx = await contract.transfer(to, amount);
    await tx.wait();
    alert("Send complete!");
    loadBalance();
  } catch (err) {
    alert("Send failed.");
    console.error(err);
  }
}

async function swap() {
  try {
    const amount = ethers.utils.parseUnits(document.getElementById("swapAmount").value, 18);
    const tx = await contract.swapDUSDForETH(amount);
    await tx.wait();
    alert("Swap complete!");
    loadBalance();
  } catch (err) {
    alert("Swap failed.");
    console.error(err);
  }
}
</script>
</body>
</html>

